openapi: 3.0.3
info:
  title: VICIdial Agent UI API
  version: 1.1.0
servers:
  - url: http://localhost:8080
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username: { type: string }
        password: { type: string }
    LoginResponse:
      type: object
      properties:
        accessToken: { type: string }
        role: { type: string, enum: [AGENT, REPORT_ADMIN] }
        username: { type: string }
    VicidialSettingsRequest:
      type: object
      required: [baseUrl, apiUser, apiPass, source]
      properties:
        baseUrl: { type: string }
        apiUser: { type: string }
        apiPass: { type: string }
        source: { type: string }
    VicidialSettingsResponse:
      type: object
      properties:
        baseUrl: { type: string }
        apiUser: { type: string }
        source: { type: string }
        updatedAt: { type: string, format: date-time }
    AgentProfileResponse:
      type: object
      properties:
        hasAgentPass: { type: boolean }
        lastPhoneLogin: { type: string, nullable: true }
        lastCampaign: { type: string, nullable: true }
        rememberCredentials: { type: boolean }
        connected: { type: boolean }
        connectedPhoneLogin: { type: string, nullable: true }
        connectedCampaign: { type: string, nullable: true }
        agentUser: { type: string }
    AgentPassUpdateRequest:
      type: object
      required: [agentPass]
      properties:
        agentPass: { type: string }
    PhoneConnectRequest:
      type: object
      required: [phoneLogin]
      properties:
        phoneLogin: { type: string }
    CampaignConnectRequest:
      type: object
      required: [campaignId]
      properties:
        campaignId: { type: string }
        mode: { type: string, enum: [predictive, manual], default: predictive }
        rememberCredentials: { type: boolean, default: true }
    VicidialCampaignsResponse:
      type: object
      properties:
        phoneLogin: { type: string }
        campaigns:
          type: array
          items: { type: string }
        raw: { type: string }
    VicidialStatusResponse:
      type: object
      properties:
        agentUser: { type: string }
        phoneConnected: { type: boolean }
        phoneLogin: { type: string, nullable: true }
        campaign: { type: string, nullable: true }
        mode: { type: string, enum: [predictive, manual], nullable: true }
        typingEnabled: { type: boolean }
    ActiveLeadResponse:
      type: object
      properties:
        leadId: { type: integer, nullable: true }
        phoneNumber: { type: string, nullable: true }
        campaign: { type: string, nullable: true }
    AgentContextResponse:
      type: object
      properties:
        lead:
          type: object
          properties:
            leadId: { type: integer }
            phoneNumber: { type: string }
            campaign: { type: string }
            dni: { type: string }
        customer:
          type: object
          properties:
            dni: { type: string }
            firstName: { type: string }
            lastName: { type: string }
        phones:
          type: array
          items:
            type: object
            properties:
              phoneNumber: { type: string }
              isPrimary: { type: boolean }
        interactions:
          type: array
          items:
            type: object
            properties:
              id: { type: integer }
              dispo: { type: string }
              notes: { type: string }
              createdAt: { type: string, format: date-time }
              syncStatus: { type: string, enum: [PENDING, SYNCED, FAILED] }
        dispoOptions:
          type: array
          items: { type: string }
    InteractionRequest:
      type: object
      required: [mode, leadId, phoneNumber, campaign, dni, dispo]
      properties:
        mode: { type: string, enum: [predictive, manual] }
        leadId: { type: integer }
        phoneNumber: { type: string }
        campaign: { type: string }
        dni: { type: string }
        dispo: { type: string }
        notes: { type: string }
        extra: { type: object, additionalProperties: true }
    InteractionResponse:
      type: object
      properties:
        id: { type: integer }
        syncStatus: { type: string, enum: [PENDING, SYNCED, FAILED] }
        message: { type: string }
    PreviewActionRequest:
      type: object
      required: [leadId, campaign, action]
      properties:
        leadId: { type: integer }
        campaign: { type: string }
        action: { type: string, enum: [DIALONLY, SKIP, FINISH] }
    PauseRequest:
      type: object
      required: [action]
      properties:
        action: { type: string, enum: [PAUSE, RESUME] }
    OkResponse:
      type: object
      properties:
        ok: { type: boolean }
    ImportResponse:
      type: object
      properties:
        imported: { type: integer }
        failed: { type: integer }
        errors:
          type: array
          items: { type: string }
paths:
  /api/auth/login:
    post:
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema: { $ref: '#/components/schemas/LoginResponse' }
  /api/settings/vicidial:
    get:
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/VicidialSettingsResponse' }
    put:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/VicidialSettingsRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OkResponse' }
  /api/agent/profile:
    get:
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AgentProfileResponse' }
  /api/agent/profile/agent-pass:
    put:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AgentPassUpdateRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OkResponse' }
  /api/agent/vicidial/phone/connect:
    post:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PhoneConnectRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { type: object, additionalProperties: true }
  /api/agent/vicidial/phone/disconnect:
    post:
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OkResponse' }
  /api/agent/vicidial/campaigns:
    get:
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/VicidialCampaignsResponse' }
  /api/agent/vicidial/campaign/connect:
    post:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CampaignConnectRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { type: object, additionalProperties: true }
  /api/agent/vicidial/status:
    get:
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/VicidialStatusResponse' }
  /api/admin/users/{id}/agent-pass:
    put:
      security: [{ bearerAuth: [] }]
      parameters:
        - { name: id, in: path, required: true, schema: { type: integer } }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AgentPassUpdateRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OkResponse' }
  /api/agent/active-lead:
    get:
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ActiveLeadResponse' }
  /api/agent/context:
    get:
      security: [{ bearerAuth: [] }]
      parameters:
        - { name: leadId, in: query, required: false, schema: { type: integer } }
        - { name: phone, in: query, required: false, schema: { type: string } }
        - { name: campaign, in: query, required: false, schema: { type: string } }
        - { name: mode, in: query, required: true, schema: { type: string, enum: [predictive, manual] } }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/AgentContextResponse' }
  /api/agent/interactions:
    post:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/InteractionRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InteractionResponse' }
  /api/agent/interactions/{id}/retry-vicidial:
    post:
      security: [{ bearerAuth: [] }]
      parameters:
        - { name: id, in: path, required: true, schema: { type: integer } }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InteractionResponse' }
  /api/agent/preview-action:
    post:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PreviewActionRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OkResponse' }
  /api/agent/pause:
    post:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PauseRequest' }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OkResponse' }
  /api/vicidial/leads/import:
    post:
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file: { type: string, format: binary }
      responses:
        '200':
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ImportResponse' }
  /api/reports/summary:
    get:
      security: [{ bearerAuth: [] }]
      parameters:
        - { name: from, in: query, required: true, schema: { type: string, format: date } }
        - { name: to, in: query, required: true, schema: { type: string, format: date } }
        - { name: campaign, in: query, required: false, schema: { type: string } }
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
  /api/reports/export:
    get:
      security: [{ bearerAuth: [] }]
      parameters:
        - { name: from, in: query, required: true, schema: { type: string, format: date } }
        - { name: to, in: query, required: true, schema: { type: string, format: date } }
        - { name: format, in: query, required: true, schema: { type: string, enum: [csv] } }
      responses:
        '200':
          description: csv
